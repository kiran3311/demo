package CKYC.ICICI;

import java.awt.AWTException;
import java.awt.HeadlessException;
import java.io.File;
import java.io.IOException;
import java.util.List;

import org.openqa.selenium.By;
import org.openqa.selenium.JavascriptExecutor;
import org.openqa.selenium.NoAlertPresentException;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.interactions.Action;
import org.openqa.selenium.interactions.Actions;
import org.openqa.selenium.support.ui.Select;
import org.testng.Assert;
import org.testng.Reporter;
import org.testng.annotations.Test;
import org.apache.logging.log4j.*;

public class CentralUser extends BaseClass {
	Logger log = LogManager.getLogger("CentralUser");

// Login to the central user
	@Test(priority = -1, groups = { "New dump Upload and Process", "Upload Response", "Pending Cust Report",
			"CKYC Id Generated Report" })
	public void loginCentralUser() throws InterruptedException, IOException, HeadlessException, AWTException {
		test = extent.createTest("loginCentralUser", "Trying to logedIn with central user");
		driver.get(prd.getProperty("URL"));
		driver.findElement(By.xpath(pr.getProperty("CentralUserLoginId_loc")))
				.sendKeys(prd.getProperty("CentralUserLoginId_val"));
		driver.findElement(By.xpath(pr.getProperty("CentralUserLoginPass_loc")))
				.sendKeys(prd.getProperty("CentralUserLoginPass_val"));
		driver.findElement(By.xpath(pr.getProperty("CentralUserLoginBtn_loc"))).click();
		WebElement redirectDrop = driver.findElement(By.xpath(pr.getProperty("CentralUserRedirectDrop_loc")));
		Select selectRedirectDrop = new Select(redirectDrop);
		selectRedirectDrop.selectByVisibleText(prd.getProperty("CentralUserLoginRedirectDropOpt_val"));
		driver.findElement(By.xpath(pr.getProperty("CentralUserRedirectBtn_loc"))).click();
		log.info("Central user logged in successfully");
		Reporter.log(resultTime + " - " + "Central user logged in successfully");
		System.out.println(resultTime + " - " + "Central Loggedin");
		Thread.sleep(500);
		ss();
		test.info("Central User LoggedIn");

	}

//Upload New Dump File -->
	@Test(priority = 2, groups = { "New dump Upload and Process" })
	public void uploadDumpFile() throws InterruptedException, IOException, HeadlessException, AWTException {
		test = extent.createTest("uploadDumpFile", "Uploading Dump File");
		WebElement importTab = driver.findElement(By.xpath(pr.getProperty("CentralUserImportTab_loc")));
		js.executeScript("arguments[0].click();", importTab);
		// Actions importHover = new Actions(driver);
		// importHover.moveToElement(importTab);

		List<WebElement> importOpt = driver.findElements(By.xpath(pr.getProperty("CentralUserImportDropOPt_loc")));
		for (WebElement x : importOpt) {
			String dropText = x.getText();
			if (dropText.equals("CBS Customer Dump")) {
				x.click();
				break;
			}

		}

		driver.findElement(By.xpath(pr.getProperty("CentralUserCBSDumpFileUploadBtn_loc"))).click();
		Thread.sleep(1000);
		log.info("Dump file upload started");
		Reporter.log(resultTime + " - " + "Dump file upload started");
		System.out.println(resultTime + " - " + "Dump file upload started");
		WebElement fileInput = driver.findElement(By.xpath(pr.getProperty("CentralUserSelectDumpFileBtn_loc")));
		fileInput.sendKeys(prd.getProperty("CentralUserDumpFilePath_val"));
		Thread.sleep(1000);
		driver.findElement(By.xpath(pr.getProperty("CentralUserCBSDumpFileFinalUploadBtn_loc"))).click();

		Thread.sleep(1000);
		String alertMsg = null;

		if (driver.switchTo().alert().getText() != null) {
			// System.out.println(driver.switchTo().alert().getText());

			alertMsg = driver.switchTo().alert().getText();

			// System.out.println("entered in block");
			if (alertMsg.equals("File successfully uploaded.")) {
				log.info("Dump " + alertMsg);
				Reporter.log(resultTime + " - " + "Dump " + alertMsg);
				System.out.println(resultTime + " - " + "Dump " + alertMsg);
				test.pass("Dump " + alertMsg);
			} else {
				log.info("Dump " + alertMsg);
				Reporter.log(resultTime + " - " + "Dump " + alertMsg);
				System.out.println(resultTime + " - " + "Dump " + alertMsg);
				test.warning("Dump " + alertMsg);
			}
			Thread.sleep(1000);
			ss();
			Thread.sleep(500);
			driver.switchTo().alert().accept();

		}
	}

	// Run Image Service .exe file
	@Test(priority = 3, groups = { "New dump Upload and Process" })
	public void runImageService() throws HeadlessException, IOException, AWTException, InterruptedException {
		test = extent.createTest("runImageService", "Uploading Dump File");
		log.info("Image Upload Service exe file executed");
		Reporter.log(resultTime + " - " + "Image Upload Service exe file executed");
		System.out.println(resultTime + " - " + "Image Upload Service exe file executed");
		Runtime.getRuntime().exec(prd.getProperty("CKYCImageUploadExeFilePath_val"));
		Thread.sleep(500);
		ss();
		test.info("Image Upload Service exe file executed");
	}

	// Generate Bulk File
	@Test(priority = 4, groups = { "New dump Upload and Process" })
	public void generateCkycBulkFile() throws InterruptedException, IOException, HeadlessException, AWTException {
		test = extent.createTest("generateCkycBulkFile", "Validate functionality of generating CKYC Bulk file");
		log.info("CKYC Bulk File Generate Test Started.");
		Reporter.log(resultTime + " - " + "CKYC Bulk File Generate Test Started");
		System.out.println(resultTime + " - " + "CKYC Bulk File Generate Test Started");
		WebElement exportTab = driver.findElement(By.xpath(pr.getProperty("CentralUserExportTab_loc")));
		js.executeScript("arguments[0].click()", exportTab);
		List<WebElement> exportDropOpt = driver.findElements(By.xpath(pr.getProperty("CentralUserExportDropOpt_loc")));
		for (WebElement x : exportDropOpt) {
			String dropText = x.getText();
			if (dropText.equals("CKYC Bulk File")) {
				x.click();
				break;
			}
		}
		driver.findElement(By.xpath(pr.getProperty("CentralUserGenerateCKYCBulkViewRecordBtn_loc"))).click();
		driver.findElement(By.xpath(pr.getProperty("CentralUserGenerateBulkBtn_loc"))).click();

		Thread.sleep(1000);
		if (driver.switchTo().alert().getText() != null) {
			String alertText = driver.switchTo().alert().getText();
			System.out.println(resultTime + " - " + "CKYC Bulk File --> " + alertText);
			log.info("CKYC Bulk " + alertText);
			Reporter.log(resultTime + " - " + "CKYC Bulk " + alertText);
			test.info("CKYC Bulk " + alertText);
			Thread.sleep(1000);
			ss();
			Thread.sleep(500);
			driver.switchTo().alert().accept();
		}

	}

// Upload CKYC Response file
	@Test(priority = 5, groups = { "Upload Response" })
	public void uploadCkycResponce() throws InterruptedException, IOException, HeadlessException, AWTException {
		test = extent.createTest("uploadCkycResponce", "Validating CKYC Response file upload functionality");
		log.info("CKYC Responce upload started");
		Reporter.log(resultTime + " - " + "CKYC Responce upload started");
		System.out.println(resultTime + " - " + "CKYC Responce upload started");
		WebElement imporTab = driver.findElement(By.xpath(pr.getProperty("CentralUserImportTab_loc")));
		js.executeScript("arguments[0].click()", imporTab);
		List<WebElement> importDropOpt = driver.findElements(By.xpath(pr.getProperty("CentralUserImportDropOPt_loc")));
		for (WebElement x : importDropOpt) {
			String dropText = x.getText();
			if (dropText.equals("CKYC Response")) {
				x.click();
				break;
			}
		}
		Thread.sleep(1000);
		driver.findElement(By.xpath(pr.getProperty("CentralUserCKYCResponseUploadImportBtn_loc"))).click();
		WebElement ckycReponseFile = driver
				.findElement(By.xpath(pr.getProperty("CentralUserCKYCResponseFileSelectBtn_loc")));
		ckycReponseFile.sendKeys(prd.getProperty("CentralUserCKYCResponseFile_val"));
		driver.findElement(By.xpath(pr.getProperty("CentralUserCKYCResponseFileFinalUploadBtn_loc"))).click();

		String alertMsg = null;
		Thread.sleep(1000);
		if (driver.switchTo().alert().getText() != null) {
			alertMsg = driver.switchTo().alert().getText();

			System.out.println(resultTime + " - " + alertMsg);
			log.info("Response " + alertMsg);
			Reporter.log(resultTime + " - " + "Response " + alertMsg);
			test.info("Response " + alertMsg);
			Thread.sleep(1000);
			ss();
			Thread.sleep(500);
			driver.switchTo().alert().accept();
		}
	}

// CKYC ID generated Report

	@Test(priority = 6, groups = { "CKYC Id Generated Report" })
	public void ckycIdGeneretedReport() throws InterruptedException, IOException, HeadlessException, AWTException {
		test = extent.createTest("ckycIdGeneretedReport", "Validating Functionality of generating report for CKYC ID generated customer");
		log.info("CKYC ID Grnerate Report Test Start");
		test.info("CKYC ID Grnerate Report Test Start");
		Reporter.log(resultTime + " - " + "CKYC ID Grnerate Report Test Start");
		System.out.println(resultTime + " - " + "CKYC ID Grnerate Report Test Start");
		WebElement exportTab = driver.findElement(By.xpath(pr.getProperty("CentralUserExportTab_loc")));
		js.executeScript("arguments[0].click()", exportTab);
		List<WebElement> exportDroplist = driver.findElements(By.xpath(pr.getProperty("CentralUserExportDropOpt_loc")));
		for (WebElement x : exportDroplist) {
			String dropText = x.getText();
			if (dropText.equals("CKYC ID Generated")) {
				x.click();
				break;
			}

		}

//Start Date Picker---->

		// Pick month
		WebElement startDate = driver
				.findElement(By.xpath(pr.getProperty("CentralUserCKYCIdGeneratedReportStartDate_loc")));
		startDate.click();
		Thread.sleep(1000);
		WebElement month = driver
				.findElement(By.xpath(pr.getProperty("CentralUserCKYCIdGenerateReportMonthSelect_loc")));
		Select monthSelect = new Select(month);
		monthSelect.selectByVisibleText(prd.getProperty("CentralUserCKYCGeneratedIdReport_StartDateMonth_val"));

		// Pick year
		WebElement year = driver.findElement(By.xpath(pr.getProperty("CentralUserCKYCIdGenerateReportYearSelect_loc")));
		Select yearSelect = new Select(year);
		yearSelect.selectByVisibleText(prd.getProperty("CentralUserCKYCGeneratedIdReport_StartDateYear_val"));

		// Pick Date
		List<WebElement> dates = driver
				.findElements(By.xpath(pr.getProperty("CentralUserCKYCIdGenerateReportTotalDates_loc")));
		for (WebElement x : dates) {
			String dateText = x.getText();
			if (dateText.equals(prd.getProperty("CentralUserCKYCGeneratedIdReport_StartDateDate_val"))) {
				x.click();

				break;
			}
		}
		
		String stratDt =prd.getProperty("CentralUserCKYCGeneratedIdReport_StartDateDate_val")+ 
				prd.getProperty("CentralUserCKYCGeneratedIdReport_StartDateMonth_val") +
				prd.getProperty("CentralUserCKYCGeneratedIdReport_StartDateYear_val");
		test.info("Start Date Selected as : "+stratDt);
		Thread.sleep(1000);

		// End Date picker

		// Pick month
		WebElement endDate = driver
				.findElement(By.xpath(pr.getProperty("CentralUserCKYCIdGeneratedReportEndDate_loc")));
		endDate.click();
		Thread.sleep(1000);
		WebElement endMonth = driver
				.findElement(By.xpath(pr.getProperty("CentralUserCKYCIdGenerateReportEndMonthSelect_loc")));
		Select endMonthSelect = new Select(endMonth);
		endMonthSelect.selectByVisibleText(prd.getProperty("CentralUserCKYCGeneratedIdReport_EndDateMonth_val"));

		// Pick year
		WebElement endYear = driver
				.findElement(By.xpath(pr.getProperty("CentralUserCKYCIdGenerateReportEndYearSelect_loc")));
		Select endYearSelect = new Select(endYear);
		endYearSelect.selectByVisibleText(prd.getProperty("CentralUserCKYCGeneratedIdReport_EndDateYear_val"));

		// Pick Date
		List<WebElement> endDates = driver
				.findElements(By.xpath(pr.getProperty("CentralUserCKYCIdGenerateReportEndTotalDates_loc")));
		for (WebElement x : endDates) {
			String dateText = x.getText();
			if (dateText.equals(prd.getProperty("CentralUserCKYCGeneratedIdReport_EndDateDate_val"))) {
				x.click();

				break;
			}
		}
		
		String endDt = prd.getProperty("CentralUserCKYCGeneratedIdReport_EndDateDate_val")+
				prd.getProperty("CentralUserCKYCGeneratedIdReport_EndDateMonth_val")+
				prd.getProperty("CentralUserCKYCGeneratedIdReport_EndDateYear_val");
		
		Thread.sleep(1000);
		driver.findElement(By.xpath(pr.getProperty("CentralUserCkycGenerateReportGenerateBtn_loc"))).click();

		Thread.sleep(1000);
		if (driver.switchTo().alert().getText() != null) {
			String alertText = driver.switchTo().alert().getText();
			System.out.println(resultTime + " - " + "CKYC Generated ID " + alertText);
			log.info("CKYC Generated ID " + alertText);
			Reporter.log(resultTime + " - " + "CKYC Generated ID " + alertText);

			Thread.sleep(1000);
			ss();
			Thread.sleep(500);
			driver.switchTo().alert().accept();
		}

	}

//Generate Pending Customer Report
	@Test(priority = 7, groups = { "Pending Cust Report" })
	public void gerneratePendingCustomerReport()
			throws InterruptedException, IOException, HeadlessException, AWTException {
		log.info("Generating pending customer Report");
		Reporter.log(resultTime + " - " + "Generating pending customer Report");
		System.out.println(resultTime + " - " + "Generating pending customer Report");
		WebElement reportTab = driver.findElement(By.xpath(pr.getProperty("CentralUserReportTab_loc")));
		js.executeScript("arguments[0].click()", reportTab);
		List<WebElement> reportTabOptions = driver
				.findElements(By.xpath(pr.getProperty("CentralUserReportDropOpts_loc")));
		for (WebElement x : reportTabOptions) {
			String dropText = x.getText();
			if (dropText.equals("Pending Customer Report")) {
				x.click();
				break;
			}
		}

		Thread.sleep(1000);
		// Start Date picker
		driver.findElement(By.xpath(pr.getProperty("CentralUserReportGeneratePendingCustReportStartDate_loc"))).click();
		;
		WebElement selectStartDateMonth = driver
				.findElement(By.xpath(pr.getProperty("CentralUserReportGeneratePendingCustReportStartDateMonth_loc")));
		Select optStartDateMonth = new Select(selectStartDateMonth);
		optStartDateMonth.selectByVisibleText(prd.getProperty("CentralUserGeneratePendingCustReportStartMonth_val"));
		WebElement selectStartDateYear = driver
				.findElement(By.xpath(pr.getProperty("CentralUserReportGeneratePendingCustReportStartDateYear_loc")));
		Select optStartDateYear = new Select(selectStartDateYear);
		optStartDateYear.selectByVisibleText(prd.getProperty("CentralUserGeneratePendingCustReportStartYear_val"));
		List<WebElement> startDates = driver.findElements(
				By.xpath(pr.getProperty("CentralUserReportGeneratePendingCustReportStartDateTotalDates_loc")));
		for (WebElement x : startDates) {
			String dateText = x.getText();
			if (dateText.equals(prd.getProperty("CentralUserGeneratePendingCustReportStartDate_val"))) {
				x.click();
				break;
			}
		}

		// End Date picker

		driver.findElement(By.xpath(pr.getProperty("CentralUserReportGeneratePendingCustReportEndDate_loc"))).click();

		WebElement selectEndDateMonth = driver
				.findElement(By.xpath(pr.getProperty("CentralUserReportGeneratePendingCustReportEndDateMonth_loc")));
		Select optEndDateMonth = new Select(selectEndDateMonth);
		optEndDateMonth.selectByVisibleText(prd.getProperty("CentralUserGeneratePendingCustReportEndMonth_val"));

		WebElement selectEndDateYear = driver
				.findElement(By.xpath(pr.getProperty("CentralUserReportGeneratePendingCustReportEndDateYear_loc")));
		Select optEndDateYear = new Select(selectEndDateYear);
		optEndDateYear.selectByVisibleText(prd.getProperty("CentralUserGeneratePendingCustReportEndYear_val"));
		List<WebElement> endDates = driver.findElements(
				By.xpath(pr.getProperty("CentralUserReportGeneratePendingCustReportEndDateTotalDates_loc")));
		for (WebElement x : endDates) {
			String dateText = x.getText();
			if (dateText.equals(prd.getProperty("CentralUserGeneratePendingCustReportEndDate_val"))) {
				x.click();
				break;
			}
		}

		driver.findElement(By.xpath(pr.getProperty("CentralUserReportGeneratePendingcustReportGenerateBtn_loc")))
				.click();

		if (driver.switchTo().alert().getText() != null) {
			String alertText = driver.switchTo().alert().getText();
			System.out.println(resultTime + " - " + "Pending Customer Report : " + alertText);
			log.info("Pending Customer Report : " + alertText);
			Reporter.log(resultTime + " - " + "Pending Customer Report : " + alertText);
			Thread.sleep(1000);
			ss();
			Thread.sleep(500);
			driver.switchTo().alert().accept();

		}

	}

}
